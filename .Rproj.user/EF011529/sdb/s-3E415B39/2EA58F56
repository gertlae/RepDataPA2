{
    "contents" : "#Impact of servere weather events on population health and the economy in the US  \n## Synopsis  \nThis report aims to describe the impact of severe weather events in the US on population health and the economy by answering two questions. Across the United States, which types of events are most harmful with respect to population health? Across the United States, which types of events have the greatest economic consequences? Underlying analysis helps to anwser these two questions by exploring the data of the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database.  \nImpact on population health is assessed by a Pareto analsysis on the weather event types with highest injury and fatality rates in this database.  \nEconomical impact is assessed by a Pareto analsyis on the weather event types causing the higest total cost for property and crop damage.\n \n## Data Processing  \nWe record the platform information on which this analysis is created.\n```{r, echo=T, warning = F, message = F}\nsessionInfo()\n```\nWe download the file.\n```{r, echo=T, warning = F, message = F, cache = T}\nfileurl = \"http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\"\ndownload.file(fileurl, destfile = \"StormData.csv.bz2\")\ndate()\n```\nThen we unzip it and save the unzipped file.\n```{r, echo=T, warning = F, message = F, cache = T}\nlibrary(R.utils)\nbunzip2(\"StormData.csv.bz2\",\"StormData.csv\",overwrite=TRUE, remove=FALSE)\n``` \nWe load the data set and convert it to a dplyr table for easier processing.\n```{r, echo=T, warning = F, message = F}\nlibrary(dplyr)\nStormData <- read.csv(\"StormData.csv\", header = TRUE)\nStormData <- tbl_df(StormData)\n``` \nWe check the amount of obervations loaded.\n```{r, echo=T, warning = F, message = F}\ndim(StormData)\n```\nWe will assess the impact on population heatlh by looking at the fatalities and injuries variables per event type over time across the US. From [www.ncdc.noaa.gov/stormevents/details.jsp](http://www.ncdc.noaa.gov/stormevents/details.jsp) we know that only from 1996 to present, all the 48 event types are recorded as defined in NWS Directive 10-1605. As the purpose is to compare between event types, we filter out all data that is from before 1996.\n\nFirst convert to R date format and extract the year.\n```{r, echo=T, warning = F, message = F}\nStormData$Year = strptime(StormData$BGN_DATE, format =\"%m/%d/%Y %H:%M:%S\")\nStormData$Year = as.numeric(format(StormData$Year,'%Y'))\ntable(StormData$Year)\n```\nThen keep only the data after 1995\n```{r, echo=T, warning = F, message = F}\nStormData = StormData[StormData$Year > 1995,]\ntable(StormData$Year)\n```\nFor the economical impact we need the amounts taking into consideration the exponent information.\n```{r, echo=T, warning = F, message = F}\nsummary(StormData$PROPDMGEXP)\nsummary(StormData$CROPDMGEXP)\n```\nWe will only convert the K (kilo) , M (million) and B(billion) exponents and leave other as is.\n```{r, echo=T, warning = F, message = F}\nStormData$PROPDMG = ifelse(StormData$PROPDMGEXP == \"K\",\n                                StormData$PROPDMG * 10^3,\n                                ifelse( StormData$PROPDMGEXP == \"M\",\n                                        StormData$PROPDMG * 10^6,\n                                        ifelse (StormData$PROPDMGEXP== \"B\",\n                                                StormData$PROPDMG * 10^9,\n                                                StormData$PROPDMG\n                                        )\n                                )\n                     )\nStormData$CROPDMG = ifelse(StormData$CROPDMGEXP == \"K\",\n                                StormData$CROPDMG * 10^3,\n                                ifelse( StormData$CROPDMGEXP == \"M\",\n                                        StormData$CROPDMG * 10^6,\n                                        ifelse( StormData$CROPDMGEXP == \"B\",\n                                                StormData$CROPDMG * 10^9,\n                                                StormData$CROPDMG\n                                        )\n                                )\n                     )\n```\n## Results\n\n### The health impact.\nWe group the data per event type across the US and over time and we calculate the total of the injuries and fatalities variables.\n\n```{r, echo=T, warning = F, message = F}\nStormData$BGN_DATE = as.character(StormData$BGN_DATE) ## to avoid POSIX error in dplyr group_by\nHealthImpact = StormData %>%\n        group_by(EVTYPE) %>%\n        summarise(                \n                totFatal = sum(FATALITIES, na.rm = T ),\n                totInjur = sum(INJURIES, na.rm = T)\n                  )\n```\nUsing Pareto analysis to find the most harmful event types by looking at the Fatalities and Injuries respectively. \nPreparing the vectors to create the Pareto chart\n```{r, echo=T, warning = F, message = F}\nHI_F = HealthImpact$totFatal\nHI_I = HealthImpact$totInjur\nnames(HI_F) = HealthImpact$EVTYPE\nnames(HI_I) = HealthImpact$EVTYPE\n```\nCreating the Pareto charts for the two vriables focusing on most important event types. The red lines are at 80% of the total cumulative impact whereas the Pareto charts and tables are on the top 15 for readability.\n```{r, echo=T, warning = F, message = F,Pareto_1_2}\nTop_HI_F = head(sort(HI_F, decreasing=TRUE), 15)\nTop_HI_I = head(sort(HI_I, decreasing=TRUE), 15)\nlibrary(qcc)\npareto.chart(Top_HI_F, ylab = \"Fatalities\", main = \"Most fatal weather event types\")\nabline(h=(sum(HI_F)*.8),col=\"red\",lwd=2)\npareto.chart(Top_HI_I, ylab = \"Injuries\", main = \"Most injuring weather event types\")\nabline(h=(sum(HI_I)*.8),col=\"red\",lwd=2)\n```\n\n### The economical impact\nWe group the data per event type across the US and over time and we calculate the total dollar value of damage per event type to properties and crop. Inflation is not taken into consideration in this analysis.\n```{r, echo=T, warning = F, message = F}\nEconImp = StormData %>%\n        group_by(EVTYPE) %>%\n        summarise(totDMG = sum(PROPDMG) + sum(CROPDMG))\n```\nUsing Pareto analysis to find the event types with highest economical impact in terms of total damage cost.\nPreparing the vector to create the pareto chart, and going to million USD values.\n```{r, echo=T, warning = F, message = F}\nEI_D = EconImp$totDMG / 10^6\nnames(EI_D) = EconImp$EVTYPE\n```\nCreating the Pareto chart for the economical impact. The red line is at 80% of the total cumulative impact whereas the Pareto chart and table are on the top 15 for readability.\n```{r,echo=T, warning = F, message = F, Pareto3}\nTop_EI_D = head(sort(EI_D, decreasing=TRUE), 15)\npareto.chart(Top_EI_D, ylab = \"Damage (in MUSD)\", main = \"Highest damage cost weather event types\")\nabline(h=(sum(EI_D)*.8),col=\"red\",lwd=2)\n``` \n",
    "created" : 1443178175708.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3793825566",
    "id" : "2EA58F56",
    "lastKnownWriteTime" : 1443222644,
    "path" : "C:/EDS/DSS/RepData/RepDataPA2/PA_StormAnalysis.Rmd",
    "project_path" : "PA_StormAnalysis.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}